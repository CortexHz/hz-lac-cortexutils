# A system for LuAshitaCast

Author:  Cortex of HorizonXI

Install to:

`...game/config/addons/luashitacast/common/`

these files:

`cortexutils.lua`
`varhelpermod.lua`

Setup lua:

`...game/config/addons/luashitacast/<username_id>/<job>.lua`

e.g.
`...game/config/addons/luashitacast/Cortex_103321/BLM.lua`

Configuring Job Lua:

This system is designed so no programming of funtions is required,
all functionality is generated by parsing the config.
This means there are config sections/table-names that have special meaning, as follows.

## Documentation

### Import Utils
At top (or before setting `profile.Sets`)
```
local profile = gFunc.LoadFile('common/cortexutils.lua');
```

-----------------------------------------------------------


### Export
`sets` declared at the top:
```
local sets = {
    ['export'] = {
        Main = 'Earth Staff',
        .
        .
        .
        Feet = 'Wizard\'s Sabots',
    },
};
```

Allows for `/lac addset <name>` to easily export ingame gear to LAC (luahitacast) format.

### Weapons
-  `sets['Weapon'] = {}`  to generate weapon options, e.g
```
sets['Weapon'] = {}
sets['Weapon']['Scythe'] = {}
sets['Weapon']['Scythe']['Outrance'] = {
    main = 'A L\'Outrance',
}
sets['Weapon']['Scythe']['Suzaku'] = {
    Main = 'Suzaku\'s Scythe',
}
sets['Weapon']['Axe'] = {}
sets['Weapon']['Axe']['PetAcc'] = {
    Main = 'Maneater',
    Sub = 'Barbaroi Axe',
}
```

This will generate VarHelper Switches Weapon and W.Variant..  `/lac fwd Weapon`, `/lac fwd W.Variant`

### Handler Sections:
-- Default
-- Precast
-- Midcast
-- Preshot
-- Midshot
-- Ability
-- WeaponSkill
-- Item

e.g.
```
local WS_STR = {
    Neck = 'Spike Necklace',
    Ring2 = 'Sun Ring',
}
sets['WeaponSkill'] = {
    ['Heavy Swing'] = WS_STR,
}
```

All applicable sections will recognise hierarchy i.e.
```
[action.name] (e.g ['Sleep']) -> [Skill] -> [Type]  So the following are possible placements for `Sleep` spell
sets['Midcast'] = {
    Head = 'Party Hat',
    ['Black Magic'] = {...},
    ['Enfeebling Magic'] = {...},
    ['Sleep'] = {...},
}
```
(each section alone is enough to action a gear change, however `Sleep` section is used, otherwise `Enfeebling Magic`, otherwise `Black Magic` )
This can be nested at any point.
```
sets['Midcast'] = {
    ['Black Magic'] = {
        ['Sleep'] = {...},
        ['Enfeebling Magic'] = {
        },
    },
}
```

`Default` is a special case where the trigger is not the action (there is no action), it's the players status (Idle, Engaged, Resting.. etc), i.e.
```
sets['Default'] = {
    ['Idle'] = {...},
    ['Resting'] = {...},
    ['Engaged'] = {...},
    ['Pet] = {
        ['Sheep Song'] = {
            Head = 'Beast Helm',
        },
    },
    ['Buff'] = {
        ['Shock Spikes'] = {
            Ring2 = 'Opuntia Hoop',
        },
        ['Blaze Spikes'] = {
            Ring2 = 'Opuntia Hoop',
        },
        ['Ice Spikes'] = {
            Ring2 = 'Opuntia Hoop',
        }, 
    },
}
```
(these keys can but may find limited elsewhere)

The `Pet` section, can be a pet ability (i.e. macc equip like above) or pet name (like for equiping HQ staffs with summons)..


Acceptable gear slots are:
`{'Main', 'Sub', 'Range', 'Ammo', 'Head', 'Neck', 'Ear1', 'Ear2', 'Body', 'Hands', 'Ring1', 'Ring2', 'Back', 'Waist', 'Legs', 'Feet'}`

Note - The case is upper for first letter, this is required as some lowercase don't seem to work with luashitacast (i.e. 'feet').

These can be specified at any level also, i.e. :
```
sets['Midcast'] = {
    Legs = 'Sorcerer\'s Tonban'
    ['Black Magic'] = {
        ['Sleep'] = {Ammo = 'Phtm. Tathlum'},
        ['Enfeebling Magic'] = {
            Head = 'Igqira Tiara',
        },
    },
}
```

### Elemental 
Again, can be put anywhere but usually under (any) Midcast section.
-- ['Elemental']['Element'/'Day'/'Weather'] - Equip sets according to element of action/day/weather.
-- can set `CheckClash = true/false` at any level of 'Elemental', which will check if element of action is
   weak to day/weather element, or to continue if same as double weather element (even if weak to day)yeah.
e.g.
```
        ['Elemental'] = {
            ['Element'] = {
                ['Fire'] = {
                    Main = 'Vulcan\'s Staff',
                },
                .
                .
                .

            },
            ['Day'] = {
                ClashCheck = true,
                ['Fire'] = {
                    Waist = 'Karin Obi',
                },
                ['Earth'] = {
                    Waist = 'Dorin Obi',
                },
                .
                .
                .
```
Note on ClashCheck: 
Day bonus is the same as single weather bonus (so if they are oposite then cancel),
double weather will dominate day weakness to confer some reduced bonus.
i.e. Obi will ensure the positive or negative (!) day/weather bonus,
so we need to avoid using day obi when weather is it's weakness (might as well wear something else).

### Thresholds 
Equip gear according to some player, action, environmental.. i.e. Sorcerer's Ring, or Movement
`PlayerThresholds = T{'HP', 'HPP', 'MP', 'MPP', 'MaxHP', 'MaxMP', 'TP'}`
`ActionThresholds = T{'MpAftercast', 'MppAftercast', 'MpCost'}`
`EnvironmentThresholds = T{'Area', 'Time', 'MoonPhase', 'MoonPercent'}`
e.g
```
sets['Default'] = {
    ['Idle'] = {
        ['Movement'] = {
            Feet = 'Herald\'s Gaiters',
            ['Thresholds'] = {
                ['Time'] = {
                    ['Dusk'] = {
                        threshold = 17,
                        operator = '>',
                        ['gear'] = {
                            Feet = 'Ninja Kyahan +1'
                        },
                    },
                    ['Dawn'] = {
                        threshold = 7,
                        operator = '<',
                        ['gear'] = {
                            Feet = 'Ninja Kyahan +1'
                        },
                    },
                },
            },
            ['Elemental'] = {
                ['Weather'] = {
                    ['Earth'] = {
                        Feet = 'Desert Boots',
                    },
                },
            },
        },
    },
}
```
(could even nest the Movement gear in a toggle `['Movement']['VarToggles']['Movement'] = {...}` if you don't want auto move swaps on)

### Cycling and Toggle Sets
The following are special table headings that can be nested at any level and mixed together:

- Alpha/Omega - Beginning and end sections, being applied before and after all others (within hierarchy).

- VarHelpers
-- VarCycles - A section header for creating cycling switches
-- VarToggles - A section header for boolean gear switches
e.g
```
sets['Default'] = {
    ['Idle'] = {
        ['VarCycles'] = {
            ['Idle'] = {
                ['Default'] = {Ring2 = 'Phalanx Ring', ...etc},
                ['Defense'] = {},
                ['L65'] = {...},
            },
        },
        ['VarToggles'] = {
            ['Fishing'] = {...},
            ['Working'] = {...},
        },
.
.
.
```
(`/lac fwd Idle` would cycle, `/lac fwd Fishing` would equip/unequip)

To hide these switches from the UI list, `VarVisible = false` can be set under `['Var...'][...]`  i.e. 
```
        ['VarToggles'] = {
            ['Fishing'] = {
                VarVisible = false,
                ...
            },
```

The same named switches can be used in different sections, however the gearsets are local to those sections..
(i.e. switch for `Sorcerer\'s Ring` in both precast (-hp gear) and midcast (for nuke)..)


`'Movement'` - A section for movement gear (usually under `['Default']['Idle']`), equips when you are moving.

### Strategies

`sets[Strategy] = {}`  to specify default switch settings, e.g
```
sets['Strategy'] = {
    ['Default'] = {
        Idle = 'Defense',
        TP = 'Default',
        Nuke = 'MAtt',
        SorcRing = true,
        Weapon = 'Staff',
        ['W.Variant'] = 'Defense',
        Burst = false,
    },
    ['L65'] = {
        Idle = 'L65',
        TP = 'Default',
        Nuke = 'L65',
        SorcRing = false,
        Weapon = 'Staff',
        ['W.Variant'] = 'Defense',
        Burst = false,
    },
}
```

To Cycle between
`/lac fwd Strategy`
or Set
`/lac fwd Strategy L65`



-----------------------------------------------------------

### Example Lua

https://github.com/CortexHz/hz-lac-cortexutils/blob/main/BLM.lua

```
local profile = gFunc.LoadFile('common/cortexutils.lua');

local sets = {
    ['export'] = {
        Main = 'Earth Staff',
        .
        .
        .
        Feet = 'Wizard\'s Sabots',
    },
};

-- Strategies
sets['Strategy'] = {
    ['Default'] = {
        Idle = 'Defense',
        TP = 'Default',
        Nuke = 'MAtt',
        SorcRing = true,
        Weapon = 'Staff',
        ['W.Variant'] = 'Defense',
        Burst = false,
    },
    ['L65'] = {
        Idle = 'L65',
        TP = 'Default',
        Nuke = 'L65',
        SorcRing = false,
        Weapon = 'Staff',
        ['W.Variant'] = 'Defense',
        Burst = false,
    },
}

-- Weapons
sets['Weapon'] = {}
sets['Weapon']['Scythe'] = {}
sets['Weapon']['Scythe']['Outrance'] = {
    main = 'A L\'Outrance',
}
sets['Weapon']['Staff'] = {}
sets['Weapon']['Staff']['Defense'] = {
    main = 'Earth Staff',
}
sets['Weapon']['Club'] = {}
sets['Weapon']['Club']['None'] = {}
sets['Weapon']['Club']['Warp'] = {
    main = 'Warp Cudgel',
}

-- HandleDefault
sets['Default'] = {
    ['Idle'] = {
        ['VarCycles'] = {
            ['Idle'] = {
                ['Default'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
                ['Defense'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
                ['L65'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
            },
        },
        ['VarToggles'] = {
            ['Fishing'] = {
                VarVisible = false,
                Ammo = '',
                Ranged = '',
                Body = 'Angler\'s Tunica',
                Hands = 'Angler\'s Gloves',
                Legs = 'Angler\'s Hose',
                Feet = 'Waders',
            },
            ['Working'] = {
                VarVisible = false,
                Body = 'Worker Tunica',
                Hands = 'Worker Gloves',
                Legs = 'Worker Hose',
                Feet = 'Worker Boots',
            },
        },
        ['Movement'] = {
            --Feet = 'Waders',
            ['Thresholds'] = {
                ['Time'] = {
                    ['Dusk'] = {
                        threshold = 17,
                        operator = '>',
                        ['gear'] = {
                            --Feet = 'Seer\'s Pumps +1'
                        },
                    },
                    ['Dawn'] = {
                        threshold = 7,
                        operator = '<',
                        ['gear'] = {
                            --Feet = 'Seer\'s Pumps +1'
                        },
                    },
                },
            },
        },
    },
    ['Resting'] = {
        Main = 'Pluto\'s Staff',
        Neck = 'Checkered Scarf',
        --Body = 'Seer\'s Tunic +1',
        Body = 'Errant Hpl.',
        --Body = 'Black Cloak',
        Waist = 'Hierarch Belt',
        Legs = 'Baron\'s Slops',
    },
    ['Engaged'] = {
        ['VarCycles'] = {
            ['TP'] = {
                ['Default'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
                ['Acc'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
            },
        },
    },
    ['Omega'] = {   
    },
}

-- HandlePrecast
sets['Precast'] = {
    ['Alpha'] = {
    },
    ['Elemental Magic'] = {
        ['VarToggles'] = {
            ['SorcRing'] = {
                -- put -hp gear here
            },
        },
    },
}

-- HandlePrecast
local ElementalDebuff = {
        Ammo = 'Phtm. Tathlum',
        Neck = 'Elemental Torque',
        .
        .
        .
}
sets['Midcast'] = {
    ['Alpha'] = {
    },
    ['Elemental'] = {
        ['Element'] = {
            ['Fire'] = {
                Main = 'Vulcan\'s Staff',
            },
            .
            .
            .
            ['Dark'] = {
                Main = 'Pluto\'s Staff',
            },
        },
        ['Day'] = {
            ClashCheck = true,
            ['Fire'] = {
            },
            .
            .
            .
            ['Dark'] = {
            },
        },
        ['Weather'] = {
            ClashCheck = true,
            ['Fire'] = {
            },
            .
            .
            .
            ['Dark'] = {
            },
        },
    },
    ['Omega'] = {
    },
    ['Black Magic'] = {
        ['Enfeebling Magic'] = {
            Ammo = 'Phtm. Tathlum',
            .
            .
            .
        },
    },
    ['White Magic'] = {
        ['Enfeebling Magic'] = {
            Head = 'Igqira Tiara',
            .
            .
            .
        },
    },
    ['Enhancing Magic'] = {
    },
    ['Dark Magic'] = {
        Ammo = 'Phtm. Tathlum',
        .
        .
        .
    },
    ['Rasp'] = ElementalDebuff,
    ['Choke'] = ElementalDebuff,
    ['Frost'] = ElementalDebuff,
    ['Burn'] = ElementalDebuff,
    ['Drown'] = ElementalDebuff,
    ['Shock'] = ElementalDebuff,
    ['Elemental Magic'] = {
        ['VarCycles'] = {
            ['Nuke'] = {
                ['MAtt'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
                ['MAcc'] = {
                    Ammo = 'Phtm. Tathlum',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
                ['L65'] = {
                    Ammo = 'Phtm. Tathlum',
                    Head = 'Wizard\'s Petasos',
                    .
                    .
                    .
                    Feet = 'Wizard\'s Sabots',
                },
            },
        },
        ['VarToggles'] = {
            ['Burst'] = {
                Hands = 'Sorcerer\'s Gloves',
            },
        },
        ['Elemental'] = {
            ['Day'] = {
                ['Fire'] = {
                    Legs = 'Sorcerer\'s Tonban',
                },
                .
                .
                .
                },
                ['Dark'] = {
                    Legs = 'Sorcerer\'s Tonban',
                },
            },
        },
        ['Thresholds'] = {
            ['HPP'] = {
                ['SRing'] = {
                    threshold = 76,
                    operator = '<',
                    ['gear'] = {
                        ['VarToggles'] = {
                            ['SorcRing'] = {
                                --Ring2 = 'Sorcerer\'s Ring',
                            },
                        },
                    },
                },
            },
            ['MppAftercast'] = {
                ['UNeck'] = {
                    threshold = 51,
                    operator = '<',
                    ['gear'] = {
                        --Neck = 'Uggalepih Pendant',
                    },
                },
            },
        },
    },
}

-- HandlePrecast
sets['Preshot'] = {
}
-- HandlePrecast
sets['Midshot'] = {
}
-- HandleAbility
sets['Ability'] = {
}
-- HandleWeaponSkill
local WS_STR = {
    Neck = 'Spike Necklace',
    Ring2 = 'Sun Ring',
}
sets['WeaponSkill'] = {
    ['Heavy Swing'] = WS_STR,
}
-- HandleItem
sets['Item'] = {
}
profile.Sets = sets;
profile.Packer = {
};

return profile;
```